{% extends "base.html" %}

{% block title %}LightLink - System Health{% endblock %}

{% block content %}
<h1 class="page-title">System Health</h1>

{% if error %}
    <div class="alert alert-error">
        <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        Connection Error: {{ error }}
    </div>
    
    <div class="card">
        <div style="text-align: center; padding: 48px;">
            <div style="font-size: 4rem; margin-bottom: 24px;">üîå</div>
            <h3 style="margin-bottom: 16px;">Backend API Unavailable</h3>
            <p style="color: #666; margin-bottom: 32px;">The backend API server may not be running. Please start the API server to enable full functionality.</p>
            <div style="background: #f5f5f5; padding: 16px; border-radius: 8px; margin-bottom: 24px; font-family: monospace;">
                python start_backend.py
            </div>
            <button class="btn btn-primary" onclick="location.reload()">
                Retry Connection
            </button>
        </div>
    </div>

{% elif health %}
    <!-- Overall Status -->
    <div class="card" style="margin-bottom: 32px;">
        <div style="text-align: center; padding: 48px;">
            {% if health.status == 'healthy' %}
                <div style="font-size: 4rem; margin-bottom: 24px;">‚úÖ</div>
                <h3 style="color: #22c55e; margin-bottom: 8px;">System Healthy</h3>
                <p style="color: #666;">All systems operational</p>
            {% else %}
                <div style="font-size: 4rem; margin-bottom: 24px;">‚ö†Ô∏è</div>
                <h3 style="color: #f59e0b; margin-bottom: 8px;">System Degraded</h3>
                <p style="color: #666;">Some components may not be fully operational</p>
            {% endif %}
            <small style="color: #999;">Last checked: {{ health.timestamp }}</small>
        </div>
    </div>

    <!-- Component Status -->
    <div class="grid grid-2">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">API Information</h3>
            </div>
            <div class="data-table">
                <div class="data-row">
                    <span class="data-label">API Version</span>
                    <span class="data-value">{{ health.api_version }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Active Tasks</span>
                    <span class="data-value">{{ health.system_info.active_tasks }}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Status</span>
                    <span class="data-value" style="color: #22c55e;">Online</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">ML Model Status</h3>
            </div>
            <div class="data-table">
                {% for model_name, is_loaded in health.models_loaded.items() %}
                <div class="data-row">
                    <span class="data-label">{{ model_name|title|replace('_', ' ') }}</span>
                    <span class="data-value" style="color: {% if is_loaded %}#22c55e{% else %}#ef4444{% endif %};">
                        {% if is_loaded %}Ready{% else %}Not Ready{% endif %}
                    </span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
// Auto-refresh every 30 seconds
setInterval(function() {
    if (!document.hidden) {
        location.reload();
    }
}, 30000);
</script>
{% endblock %}