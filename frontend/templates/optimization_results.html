{% extends "base.html" %}

{% block title %}FSOC Link Optimization - Optimization Results{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h3>Optimization Results</h3>
                <div>
                    <a href="/optimize" class="btn btn-outline-primary">New Optimization</a>
                </div>
            </div>
            <div class="card-body">
                {% if result.success %}
                    <div class="alert alert-success">
                        <strong>Success!</strong> Optimization completed with confidence score: {{ "%.2f"|format(result.confidence_score * 100) }}%.
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5>Recommended Configuration</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-striped">
                                        <tbody>
                                            <tr>
                                                <th>Optimization ID</th>
                                                <td>{{ result.optimization_id }}</td>
                                            </tr>
                                            <tr>
                                                <th>Timestamp</th>
                                                <td>{{ result.timestamp }}</td>
                                            </tr>
                                            <tr>
                                                <th>Transmitter Height</th>
                                                <td>{{ "%.2f"|format(result.recommendations.tx_height_m) }} m</td>
                                            </tr>
                                            <tr>
                                                <th>Receiver Height</th>
                                                <td>{{ "%.2f"|format(result.recommendations.rx_height_m) }} m</td>
                                            </tr>
                                            <tr>
                                                <th>Transmitter Material</th>
                                                <td>{{ result.recommendations.tx_material }}</td>
                                            </tr>
                                            <tr>
                                                <th>Receiver Material</th>
                                                <td>{{ result.recommendations.rx_material }}</td>
                                            </tr>
                                            <tr>
                                                <th>Wavelength</th>
                                                <td>{{ result.recommendations.wavelength_nm }} nm</td>
                                            </tr>
                                            <tr>
                                                <th>Transmitter Power</th>
                                                <td>{{ "%.2f"|format(result.recommendations.tx_power_dbm) }} dBm</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5>Performance Metrics</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table table-striped">
                                        <tbody>
                                            <tr>
                                                <th>Expected Received Power</th>
                                                <td>{{ "%.2f"|format(result.recommendations.expected_rx_power_dbm) }} dBm</td>
                                            </tr>
                                            <tr>
                                                <th>Link Margin</th>
                                                <td>{{ "%.2f"|format(result.recommendations.link_margin_db) }} dB</td>
                                            </tr>
                                            <tr>
                                                <th>Expected Reliability</th>
                                                <td>{{ "%.2f"|format(result.recommendations.expected_reliability * 100) }}%</td>
                                            </tr>
                                            <tr>
                                                <th>Optimization Score</th>
                                                <td>{{ "%.2f"|format(result.recommendations.optimization_score) }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h5>Confidence Score</h5>
                                </div>
                                <div class="card-body">
                                    <div class="progress" style="height: 30px;">
                                        <div class="progress-bar 
                                            {% if result.confidence_score < 0.5 %}
                                                bg-danger
                                            {% elif result.confidence_score < 0.8 %}
                                                bg-warning
                                            {% else %}
                                                bg-success
                                            {% endif %}" 
                                            role="progressbar" 
                                            style="width: {{ result.confidence_score * 100 }}%;" 
                                            aria-valuenow="{{ result.confidence_score * 100 }}" 
                                            aria-valuemin="0" 
                                            aria-valuemax="100">
                                            {{ "%.0f"|format(result.confidence_score * 100) }}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Optimization Details</h5>
                                </div>
                                <div class="card-body">
                                    <pre class="bg-light p-3 rounded"><code>{{ result.recommendations | tojson(indent=2) }}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Simulate This Configuration</h5>
                                </div>
                                <div class="card-body">
                                    <p>Run a detailed simulation with these optimized parameters:</p>
                                    <form method="POST" action="/simulate">
                                        <input type="hidden" name="lat_tx" value="{{ result.recommendations.lat_tx }}">
                                        <input type="hidden" name="lon_tx" value="{{ result.recommendations.lon_tx }}">
                                        <input type="hidden" name="height_tx" value="{{ result.recommendations.tx_height_m }}">
                                        <input type="hidden" name="material_tx" value="{{ result.recommendations.tx_material }}">
                                        
                                        <input type="hidden" name="lat_rx" value="{{ result.recommendations.lat_rx }}">
                                        <input type="hidden" name="lon_rx" value="{{ result.recommendations.lon_rx }}">
                                        <input type="hidden" name="height_rx" value="{{ result.recommendations.rx_height_m }}">
                                        <input type="hidden" name="material_rx" value="{{ result.recommendations.rx_material }}">
                                        
                                        <input type="hidden" name="fog_density" value="{{ result.recommendations.avg_fog_density }}">
                                        <input type="hidden" name="rain_rate" value="{{ result.recommendations.avg_rain_rate }}">
                                        <input type="hidden" name="surface_temp" value="{{ result.recommendations.avg_surface_temp }}">
                                        <input type="hidden" name="ambient_temp" value="{{ result.recommendations.avg_ambient_temp }}">
                                        
                                        <input type="hidden" name="wavelength_nm" value="{{ result.recommendations.wavelength_nm }}">
                                        <input type="hidden" name="tx_power_dbm" value="{{ result.recommendations.tx_power_dbm }}">
                                        
                                        <input type="hidden" name="detailed_output" value="true">
                                        
                                        <button type="submit" class="btn btn-primary">Run Detailed Simulation</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-danger">
                        <strong>Error:</strong> {{ result.error_message }}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}